=pod

=head1 NAME
 CMP_doInitialRequestSeq,
 CMP_doKeyUpdateRequestSeq,

=head1 SYNOPSIS

 #include <openssl/cmp.h>

 X509 *CMP_doInitialRequestSeq( BIO *cbio, CMP_CTX *ctx);
 X509 *CMP_doKeyUpdateRequestSeq( BIO *cbio, CMP_CTX *ctx);

=head1 DESCRIPTION

This is the API for doing client-server sequences using CMP (Certificate Management Protocol) with OpenSSL. The conveying protocol is HTTP for now.

CMP_doInitialRequestSeq() does the sequence which obtains an initial certificate from the CA. An initialized BIO and a populated CMP_CTX structure have to be given as arguments.

CMP_doKeyUpdateRequestSeq() does the sequence which obains a certificate for an updatded key from the CA. An initialized BIO and a populated CMP_CTX structure have to be given as arguments.

=head1 NOTES

CMP is defined in RFC 4210 (and CRMF in RFC 4211).

The implementaion of CMP for OpenSSL is still work in progress. The API might change every release!

=head1 RETURN VALUES

CMP_doInitialRequestSeq() and CMP_doKeyUpdateRequestSeq() return a pointer the newly obtained X509 certificate on success, NULL on error.

=head1 EXAMPLE

The following code does an Initial Request:

	cmp_ctx = CMP_CTX_create();
	CMP_CTX_set1_serverName( cmp_ctx, opt_serverName);
	CMP_CTX_set1_referenceValue( cmp_ctx, idString, idStringLen);
	CMP_CTX_set1_secretValue( cmp_ctx, password, passwordLen);
	CMP_CTX_set0_pkey( cmp_ctx, initialPkey);
	CMP_CTX_set1_caCert( cmp_ctx, caCert);
	CMP_CTX_set_compatibility( cmp_ctx, CMP_COMPAT_CRYPTLIB);

	CMP_new_http_bio( &cbio, opt_serverName, opt_serverPort);

	initialClCert = CMP_doInitialRequestSeq( cbio, cmp_ctx);
	BIO_free(cbio);


The following code does an Key Update Request:

	cmp_ctx = CMP_CTX_create();
	CMP_CTX_set1_serverName( cmp_ctx, opt_serverName);
	CMP_CTX_set0_pkey( cmp_ctx, initialPkey);
	CMP_CTX_set0_newPkey( cmp_ctx, updatedPkey);
	CMP_CTX_set1_clCert( cmp_ctx, initialClCert);
	CMP_CTX_set1_caCert( cmp_ctx, caCert);
	CMP_CTX_set_compatibility( cmp_ctx, CMP_COMPAT_CRYPTLIB);

	CMP_new_http_bio( &cbio, opt_serverName, opt_serverPort);

	updatedClCert = CMP_doKeyUpdateRequestSeq( cbio, cmp_ctx);
	BIO_free(cbio);

=head1 TODO

A lot!

=head1 SEE ALSO

CMP_CTX, CMP_http
